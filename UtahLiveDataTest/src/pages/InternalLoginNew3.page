<!--  
    Page Defines Internal Login
    ***********************************************************
    Audit History
    ***********************************************************
  
    10/29/2015      swati singh                 created
    *********************************************************** 
-->
<apex:page controller="InternalLoginCtrl" standardstylesheets="false" showHeader="false" sidebar="false" action="{!redirect}">
    <c:ExternalLibrary />   
    
    <!-- <apex:includeScript value="{!URLFOR($Resource.GovGrantsExternal, 'Scroll/JS/unslider.js')}" /> -->
    <script src="/soap/ajax/24.0/connection.js" type="text/javascript"></script>
    <apex:stylesheet value="{!URLFOR($Resource.GovGrantsExternal, 'ImageScroll/CSS/style.css')}" />  
    
    <style>
    #internalLoginPage .form-control{
     border-radius: 0px !important;
    }
   #internalLoginPage #mainTabsId{
    height: 80px !important;
    }

  #internalLoginPage .bs .btn {
   border-radius: 0px; 
   }
   
  .inputText{
    height: 44px;
    border-width: 1px;
    width: 90%;
    margin-left: 20px;
   }
   body { height: 100%;
      margin: 0px 0px 0px 0px;
      
    }
 </style> 
    
    
    <apex:outputPanel id="scriptPanel"> 
         <script type="text/javascript">
            j$ = jQuery.noConflict();
            
            j$(function() {
                /*j$('.banner').unslider({
                speed: 500,               //  The speed to animate each slide (in milliseconds)
                delay: 300000,              //  The delay between slide animations (in milliseconds)
                complete: function() {},  //  A function that gets called after every slide animation
                keys: true,               //  Enable keyboard (left, right) arrow shortcuts
                dots: true,               //  Display dot navigation
                fluid: false              //  Support responsive design. May break non-responsive designs
                });*/
            
            });
            
            function setAcceptTermsCookie(){
                var isChecked = document.getElementById('accpeptTerms').checked;
                if(isChecked){
                    j$.cookie('apex__InternalAcceptTermChecked', 'true');
                }
            }
            
            function setInternalCookie(){
                j$.cookie('apex__isInternal', 'true');
            }
            
            function checkAcceptTerms(){
                var isChecked = document.getElementById('accpeptTerms').checked;
                if(!isChecked){
                    alert('Please accept the terms before login!');
                    return false;
                }
                return true;
            }
         
            function loging(){
                var username = "";
                var password = "";
                username = document.getElementById("userNameId").value;
                password = document.getElementById("passwordId").value;
                //var acceptTerms = checkAcceptTerms();
                //if(acceptTerms == true){
                if (username.length>=0 && password.length>=0){
                    try {
                        var result = sforce.connection.login(username, password);
                        var pathArray = result.serverUrl.split( '/' );
                        var protocol = pathArray[0];
                        var host = pathArray[2];
                        var baseUrl = protocol + '//' + host;
                        //var loginURL = baseUrl+"/secur/frontdoor.jsp?sid=" + encodeURI(result.sessionId) + "&retURL={!URLENCODE(returnUrl)}";
                        
                        var getUrl = window.location; //Get the URL parameters from/of the login window
                        var baseUrl = getUrl .protocol + "//" + getUrl.host; //Turn the parameters from the URL into a baseURL form
                        var loginURL = baseUrl+ "/secur/frontdoor.jsp?sid=" + encodeURI(result.sessionId) + "&retURL={!URLENCODE(returnUrl)}";
                        window.location = loginURL;
                    }
                    catch(error) {
                        if (error.faultcode.indexOf("INVALID_LOGIN") != -1) {
                            alert("Your login attempt has failed. The username or password may be incorrect, or your location or login time may be restricted. Please contact the administrator at your company for help.");
                            return false;
                        } else {
                            alert(error);
                        }
                    }                    
                }
                //}
                return false;
            }
            
        </script>
    </apex:outputPanel>
    
 
    <div class="bs" id="internalLoginPage">
   
      <!--   <div class="container">  -->
           <!--   <div class="row">  -->
               
                <div class="loginInsertpadding"> 
                    <div class="panel panel-default loginRemoveMargins" >
                         <div class="panel-title">
                                    Login
                        </div>
                        <div class="panel-body loginFieldsPanel" >
                           <div style="text-align: center;">
                            
                               <!---<apex:image url="{!URLFOR($Resource.stategovlogowhite)}" alt="Enterprise Grants Management System image" style="width:50%"/>  ----->
                               </div> 
                            <form class="form-signin" action="" onSubmit="return loging()">
                                
                                <div class="form-group" style="padding-top:10px;">
                                    <input autofocus="autofocus" type="email" class="form-control inputText"  id="userNameId" name="userNameId" placeholder="Username" aria-label="Username"/>
                                </div>
                                <div  class="form-group">
                                    <input type="password" class="form-control inputText"  id="passwordId" placeholder="Password" aria-label="Password"/>
                                </div>
                             <!--   <div  class="col-md-12" style="padding-left:22px;">
                                             <div class="input-group">
                                                <input type="checkbox"  id="accpeptTerms" onclick="setAcceptTermsCookie()"/>
                                                <span  onclick="window.open('{!acceptTermsURL}','_blank','width=900, height=700')"  class="loginLabelColor link loginSubLabelProperty">Accept Terms</span>
                                            </div>
                                 </div>  -->
                               <div  class="col-md-12" style="padding-left:22px;">
                                             <div class="input-group pull-left">
                                               <label><input id="remember" type="checkbox"  /> Remember Me</label>
                                                
                                            </div>
                                            <!--<div class="pull-right forgot-password-internal"><a href="#" onclick="window.open('/apex/CommunityForgotPasswordPage?internal=true')" class="pull-right">Forgot Password?</a></div>-->
                               </div>  
                    
                                <div class="clearfix">
                                    <div class="row">
                                       <div class="col-lg-12" style="padding-top: 36px; ">
                                           
                                            <div class="col-lg-12 internal-login-btn">
                                                <!-- <button type="submit" class="btn btn-success customBtn" >Log In</button> -->
                                                 <button class="btn  btn-primary btn-block " type="submit" onclick="rememberUsername()" >Login</button>
                                            </div>
                                             
                                           <!-- <div class="col-md-6" > --->
                                               <!--  <span class="loginLabelColor link loginSubLabelProperty" style="color:#0070D2;" onclick="window.open('/apex/CommunityForgotPasswordPage')">Forgot Password?</span> -->
                                                <!-- <a href="#" onclick="window.open('/apex/CommunityForgotPasswordPage')" class="pull-right">Forgot Password?</a> -->

                                            <!-- </div> --->
                                        </div>
                                    </div>
                                   
                                   
                                </div>
                            </form>
                       <!--  </div> -->
                   <!--  </div> -->
                </div> 
                
            </div>
          
       </div>
    </div>
  
 
    
    <script>
        var acceptTermsChecked = j$.cookie('apex__InternalAcceptTermChecked');
       // if(acceptTermsChecked == true || acceptTermsChecked == 'true'){
         //   document.getElementById('accpeptTerms').checked = true;
      //  }
        setInternalCookie();
        ///////////////////////////////
         function rememberUsername(){
             if (j$('#remember').is(':checked')) {
                    var username = j$('#userNameId').val();
                    console.log("I am here");
                    
                    // set cookies to expire in 14 days
                    j$.cookie('username', username, { expires: 14 });
                    j$.cookie('remember', true, { expires: 14 });
                    }
             else {
                  // reset cookies
                  if (j$('#userNameId').val() != null){
                      j$.cookie('username', username, { expires: 14 });
                      j$.cookie('remember', true, { expires: 14 });
                  }
                  else {
                    j$.cookie('username', null);
                    j$.cookie('remember', null);
                  }
                 

             }
        }
        /////////////////////
        
       
        j$(document).ready(function($){
          //Read from cookies
        var remember = j$.cookie('remember');
        if ( remember == 'true' ) {
        var username = j$.cookie('username');

        // autofill the fields
        j$('#userNameId').val(username);
        }
        });
        
    </script>
        
</apex:page>