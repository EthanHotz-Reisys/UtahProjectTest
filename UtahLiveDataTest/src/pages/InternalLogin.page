<!--  
    Page Defines Internal Login
    ***********************************************************
    Audit History
    ***********************************************************
    03/31/2014      Vineeth Shetty              Created
    04/17/2014      Vineeth Shetty              Modified (Performed URL encoding in Javascript)  
    *********************************************************** 
-->
<apex:page title="Login" controller="InternalLoginCtrl" standardstylesheets="false" showHeader="false" sidebar="false" action="{!redirect}">
    <c:ExternalLibrary />   
    
    <apex:includeScript value="{!URLFOR($Resource.GovGrantsExternal, 'ImageScroll/JS/unslider.js')}" />
    <script src="/soap/ajax/24.0/connection.js" type="text/javascript"></script>
    <apex:stylesheet value="{!URLFOR($Resource.GovGrantsExternal, 'ImageScroll/CSS/style.css')}" />  
    
    
    <apex:outputPanel id="scriptPanel"> 
         <script type="text/javascript">
            j$ = jQuery.noConflict();
            
            j$(function() {
                j$('.banner').unslider({
                speed: 500,               //  The speed to animate each slide (in milliseconds)
                delay: 300000,              //  The delay between slide animations (in milliseconds)
                complete: function() {},  //  A function that gets called after every slide animation
                keys: true,               //  Enable keyboard (left, right) arrow shortcuts
                dots: true,               //  Display dot navigation
                fluid: false              //  Support responsive design. May break non-responsive designs
                });
            
            });
            
            function setAcceptTermsCookie(){
                var isChecked = document.getElementById('accpeptTerms').checked;
                if(isChecked){
                    j$.cookie('apex__InternalAcceptTermChecked', 'true');
                }
            }
            
            function setInternalCookie(){
                j$.cookie('apex__isInternal', 'true');
            }
            
            function checkAcceptTerms(){
                var isChecked = document.getElementById('accpeptTerms').checked;
                if(!isChecked){
                    alert('Please accept the terms before login!');
                    return false;
                }
                return true;
            }
         
            function loging(){
                var username = "";
                var password = "";
                username = document.getElementById("userNameId").value;
                password = document.getElementById("passwordId").value;
                //var acceptTerms = checkAcceptTerms();
                //if(acceptTerms == true){
                if (username.length>0 && password.length>0){
                    try {
                        var result = sforce.connection.login(username, password);
                        var loginURL = "https://{!URLENCODE(currentServer)}/secur/frontdoor.jsp?sid=" + encodeURI(result.sessionId) + "&retURL={!URLENCODE(returnUrl)}";
                        window.location = loginURL;
                    }
                    catch(error) {
                        if (error.faultcode.indexOf("INVALID_LOGIN") != -1) {
                            alert("Your login attempt has failed. The username or password may be incorrect, or your location or login time may be restricted. Please contact the administrator at your company for help.");
                            return false;
                        } else {
                            alert(error);
                        }
                    }                    
                }
                //}
                return false;
            }
            
        </script>
    </apex:outputPanel>
    
    <apex:composition template="GNT__PageTemplate">
        <apex:define name="content"> 
    <apex:form >
    <GNT:PageMessages />
    </apex:form>
    <div class="bs">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 loginInsertpadding">
                    <div class="banner">
                         
                        <ul>
                            <apex:repeat value="{!URLStringList}" var="URLString" >
                                 <li style="background-image: url({!URLString}); background-size: 100%; min-height:265px"></li>
                            </apex:repeat>
                        </ul> 
                    </div>
                </div>
                <div class="col-lg-4 loginInsertpadding">
                    <div class="panel panel-default loginRemoveMargins">
                        <div class="panel-heading loginFieldsPanel">
                            <form action="" onSubmit="return loging()">
                                <span class="loginLabelColor loginHeaderLabelProperty">Existing Users</span>
                                <div class="form-group">
                                    <input autofocus="autofocus" type="email" class="form-control" id="userNameId" placeholder="Username"/>
                                </div>
                                <div class="form-group">
                                    <input type="password" class="form-control" id="passwordId" placeholder="Password"/>
                                </div>
                           
                                <div class="clearfix">
                                    <div class="row">
                                       <div class="col-lg-12">
                                            <div class="input-group">
                                                <!--<input type="checkbox"  id="accpeptTerms" onclick="setAcceptTermsCookie()"/>
                                                <span  onclick="window.open('{!acceptTermsURL}','_blank','width=900, height=700')"  class="loginLabelColor link loginSubLabelProperty">Accept Terms</span>-->
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <button type="submit" class="btn btn-success customBtn">Log In</button>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <span class="loginLabelColor link loginSubLabelProperty" onclick="window.open('/apex/CommunityForgotPasswordPage')">Forgot Password?</span>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
            </div>
            <div class="row">
                <div class="col-lg-4 loginInsertpadding"><apex:include pageName="LoginWhatsNew"/></div>
                <div class="col-lg-4 loginInsertpadding"><apex:include pageName="LoginHighlights"/></div>
                <div class="col-lg-4 loginInsertpadding"><apex:include pageName="LoginTrends"/></div>
            </div>
        </div>
    </div>
    
    </apex:define>
    </apex:composition>
    
    <script>
        var acceptTermsChecked = j$.cookie('apex__InternalAcceptTermChecked');
        if(acceptTermsChecked == true || acceptTermsChecked == 'true'){
            document.getElementById('accpeptTerms').checked = true;
        }
        setInternalCookie();
    </script>
        
</apex:page>